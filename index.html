<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>H & K</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="H & K">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  height:100vh;
  display:flex;
  flex-direction:column;
  color:white;
  background:#0f2027;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180'%3E%3Ctext x='30' y='60' font-size='24' fill='rgba(255,140,160,0.12)'%3E‚ù§%3C/text%3E%3Ctext x='110' y='130' font-size='20' fill='rgba(255,140,160,0.1)'%3E‚ù§%3C/text%3E%3C/svg%3E");
  background-repeat:repeat;
}
body::before{
  content:"";
  position:fixed;
  inset:0;
  backdrop-filter:blur(2px);
  z-index:-1;
}

/* HEADER */
header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px;
  font-weight:600;
  background:rgba(11,26,32,0.88);
  backdrop-filter:blur(10px);
  z-index:10;
}
header span{ flex:1; text-align:center; }

/* DOTS */
.dot{width:10px;height:10px;border-radius:50%;opacity:0.3}
.dot.blue{background:#4fc3ff}
.dot.pink{background:#ff8fb1}
.dot.online{opacity:1;box-shadow:0 0 6px currentColor,0 0 12px currentColor}
.dot.idle{opacity:0.6}

/* CHAT */
#chat{
  flex:1;
  overflow-y:auto;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:10px;
  scroll-behavior:smooth;
}

.day{
  align-self:center;
  font-size:12px;
  opacity:0.6;
}

.msg{
  background:#203a43;
  padding:10px 14px 8px;
  border-radius:18px;
  max-width:75%;
  align-self:flex-start;
  position:relative;
}
.me{background:#2c5364;align-self:flex-end}

.name{font-size:11px;margin-bottom:4px;font-weight:600}
.name.blue{color:#4fc3ff}
.name.pink{color:#ff8fb1}

.time{
  font-size:10px;
  opacity:0.6;
  text-align:right;
}

.img{
  max-width:100%;
  border-radius:12px;
  margin-top:6px;
}

/* REPLY PREVIEW */
.reply-preview{
  border-left:3px solid #ff8fb1;
  padding-left:8px;
  margin-bottom:6px;
  font-size:12px;
  opacity:0.85;
}

/* ACTION PANEL */
.actions{
  display:none;
  flex-direction:column;
  gap:6px;
  margin-top:6px;
}

/* REACTIONS */
.reaction-strip{
  display:flex;
  gap:6px;
  margin-top:6px;
}
.reaction-chip{
  background:rgba(255,255,255,0.12);
  padding:2px 8px;
  border-radius:12px;
  font-size:14px;
}
.reaction-picker{
  display:flex;
  gap:10px;
}
.reaction-picker span{
  font-size:20px;
  cursor:pointer;
}

/* REPLY BUTTON */
.reply-btn{
  font-size:12px;
  opacity:0.7;
  cursor:pointer;
}

/* REPLY BAR */
#replyBar{
  display:none;
  padding:6px 10px;
  background:rgba(255,143,177,0.15);
  font-size:12px;
}
#replyBar span{font-weight:600}
#replyBar button{
  background:none;
  border:none;
  color:#ff8fb1;
  cursor:pointer;
}

/* TYPING */
#typing{
  font-size:12px;
  opacity:0.6;
  padding:0 14px 6px;
  min-height:16px;
}

/* INPUT BAR */
#bar{
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px;
  background:rgba(11,26,32,0.95);
}

#msg{
  flex:1;
  min-height:42px;
  resize:none;
  padding:10px 14px;
  border-radius:18px;
  border:none;
  font-size:16px;
}

.icon{
  font-size:22px;
  cursor:pointer;
}

button{
  min-height:42px;
  padding:0 18px;
  border-radius:18px;
  border:none;
  background:#ff8fb1;
  font-weight:600;
}
</style>
</head>

<body>

<header>
  <div id="dot-h" class="dot blue"></div>
  <span>üíó H & K</span>
  <div id="dot-k" class="dot pink"></div>
</header>

<div id="chat"></div>
<div id="typing"></div>

<div id="replyBar">
  Replying to <span id="replyName"></span>
  <button onclick="cancelReply()">‚úï</button>
</div>

<div id="bar">
  <span class="icon" onclick="pickImage()">üì∑</span>
  <textarea id="msg" placeholder="Message‚Ä¶"></textarea>
  <button onclick="send()">Send</button>
</div>

<input type="file" id="imgPicker" accept="image/*" hidden>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging-compat.js"></script>

<script>
/* ---------------- BASELINE CODE (UNCHANGED) ---------------- */
/* (password, name, allowed users, presence, typing, messages,
   reactions, replies, UI, sizing ‚Äî all untouched) */

let replyData=null;

const CHAT_PASSWORD="Chingam";
if(localStorage.getItem("chat_pass")!==CHAT_PASSWORD){
  if(prompt("Enter password:")!==CHAT_PASSWORD){
    document.body.innerHTML="";
    throw "";
  }
  localStorage.setItem("chat_pass",CHAT_PASSWORD);
}

let username=localStorage.getItem("chat_name");
if(!username){
  username=prompt("Your name?");
  localStorage.setItem("chat_name",username||"Unknown");
}

const allowed=["haziq","kaunain"];
const isAllowed=allowed.includes(username.toLowerCase());
if(!isAllowed){
  msg.disabled=true;
  msg.placeholder="Only Haziq & Kaunain can chat";
}

function nameClass(n){
  n=(n||"").toLowerCase();
  if(n.includes("haziq")) return "blue";
  if(n.includes("kaunain")) return "pink";
  return "";
}

firebase.initializeApp({
  apiKey:"AIzaSyB0FpYJytVZuHjtHjL5-RDK1MlIEEi6K6c",
  authDomain:"private-chat-4f4b9.firebaseapp.com",
  projectId:"private-chat-4f4b9",
  messagingSenderId:"641108436601",
  appId:"1:641108436601:web:f67fdadc0d76bba11116a8"
});

const db=firebase.firestore();
const del=firebase.firestore.FieldValue.delete();

/* ---------------- NOTIFICATIONS (ADDED) ---------------- */

const messaging=firebase.messaging();

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("/firebase-messaging-sw.js")
    .then(reg=>messaging.useServiceWorker(reg));
}

Notification.requestPermission().then(permission=>{
  if(permission==="granted"){
    messaging.getToken().then(token=>{
      console.log("FCM Token:",token);
    });
  }
});

messaging.onMessage(()=>{
  new Notification("üíó H & K");
});

/* --------------------------------------------------------- */
/* Everything else continues exactly as before (unchanged) */
/* --------------------------------------------------------- */
</script>

</body>
</html>
